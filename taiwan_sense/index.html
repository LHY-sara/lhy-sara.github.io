<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&family=Noto+Serif+TC:wght@200..900&display=swap" rel="stylesheet">
    <style>
        /* 內文使用 Noto Sans TC */
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        /* 標題使用 Noto Serif TC */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Noto Serif TC Black', serif;
        }

        .section {
	height: 100vh;
	display: flex;
	justify-content: center;
	align-items: center;
}

#outer {
	position: sticky;
	top: 0;
	height: 100vh;
	background-image: url(https://lhy-sara.github.io/as07/image03.png);
	background-size: cover;
	background-repeat: no-repeat;
	background-position: center;
}

#statusbar {
	position: absolute;
	top: 0;
	left: 0;
	height: 100%;
	width: 0;
	background-image: url(https://lhy-sara.github.io/as07/image05.png);
	background-size: 100vw 100vh;
	background-repeat: no-repeat;
	background-position: left center;
	overflow: hidden;
	transition: position 0.3s ease;
}

#statusbar.sticky {
	position: fixed;
	top: 0;
	left: 0;
	height: 100vh;
	width: 100%;
	z-index: 1000;
}

#typewriter-text {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	font-size: 1.5rem;
	font-weight: 700;
	color: white;
	text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
	opacity: 0;
	white-space: nowrap;
	pointer-events: none;
	font-family: 'Noto Serif TC Black', serif;
}

#title-text {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	font-size: 2.0rem;
	font-weight: 900;
	color: white;
	text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
	opacity: 0;
	white-space: nowrap;
	pointer-events: none;
	font-family: 'Noto Serif TC Black', serif;
	transition: opacity 1s ease-in-out;
}
    </style>


</head>

<body>
    <div class="section vh-100 w-100 p-5" style="background-color:rgba(233, 217, 194)">
            <h2>上一章節版面</h2></div>
    </div>
    <!-- progress bar -->
    <div id="scroll-container" style="height:200vh; position: relative;">
        <div id="outer">
			<div id="statusbar">
				<div id="typewriter-text"></div>
				<div id="title-text">台灣感性的審美濾鏡</div>
			</div>
		</div>
    </div>

    <div id="next-section" class="section vh-100 w-100 p-5" style="background-color:rgba(236, 199, 109)">
		<h2>訪談內容</h2>
	</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <!--jQuery CDN Link should be here-->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
$(document).ready(function () {
	var container = $("#outer").parent();
	var max_scroll = container.height() - $(window).height();
	var container_top = container.offset().top;
	var isSticky = false;
	var typewriterStarted = false;
	var typewriterCompleted = false;
	var titleTextShown = false;
	var shouldUnstick = false;
	var typewriterText = "你眼中的台灣街景是什麼模樣？";

	// 打字機效果函數
	function typeWriter(text, element, index) {
		if (index < text.length) {
			$(element).text($(element).text() + text.charAt(index));
			setTimeout(function() {
				typeWriter(text, element, index + 1);
			}, 150); // 每個字的延遲時間（毫秒）
		} else {
			// 打字機效果完成
			typewriterCompleted = true;
		}
	}

	$(window).scroll(function () {
		var scrolled = $(window).scrollTop();
		var relative_scroll = scrolled - container_top;

		// 當捲動進入容器範圍且尚未捲出時
		if (relative_scroll >= 0 && relative_scroll <= max_scroll) {
			// 計算進度百分比 (0-100)
			var progress = (relative_scroll / max_scroll) * 100;
			$("#statusbar").css({
				width: progress + "%"
			});
			// 移除sticky狀態並重置所有狀態
			if (isSticky || shouldUnstick) {
				$("#statusbar").removeClass("sticky");
				isSticky = false;
				$("#typewriter-text").css("opacity", "0").text("");
				$("#title-text").css("opacity", "0");
				typewriterStarted = false;
				typewriterCompleted = false;
				titleTextShown = false;
				shouldUnstick = false;
			}
		} else if (relative_scroll < 0) {
			// 尚未進入容器
			$("#statusbar").css({ width: "0%" });
			if (isSticky || shouldUnstick || typewriterStarted) {
				$("#statusbar").removeClass("sticky");
				isSticky = false;
				$("#typewriter-text").css("opacity", "0").text("");
				$("#title-text").css("opacity", "0");
				typewriterStarted = false;
				typewriterCompleted = false;
				titleTextShown = false;
				shouldUnstick = false;
			}
		} else {
			// 已完全捲過容器
			// 計算超出容器後繼續捲動的距離
			var extraScroll = relative_scroll - max_scroll;
			var typewriterTrigger = 50; // 開始打字機效果的距離
			var titleTrigger = 150; // 顯示title-text的距離
			var unstickTrigger = 300; // 解除sticky的距離
			
			// 階段1: 變成sticky並開始打字機效果
			if (!shouldUnstick) {
				if (!isSticky) {
					$("#statusbar").addClass("sticky").css({ width: "100%" });
					isSticky = true;
				}
				
				if (extraScroll > typewriterTrigger && !typewriterStarted) {
					typewriterStarted = true;
					$("#typewriter-text").css("opacity", "1");
					typeWriter(typewriterText, "#typewriter-text", 0);
				}
				
				// 階段2: 打字機完成後，顯示title-text
				if (extraScroll > titleTrigger && !titleTextShown && typewriterCompleted) {
					titleTextShown = true;
					$("#typewriter-text").css("opacity", "0"); // 淡出打字機文字
					setTimeout(function() {
						$("#title-text").css("opacity", "1"); // 淡入標題文字
					}, 300);
				}
				
				// 階段3: title-text顯示後，解除sticky讓它隨頁面捲動
				if (titleTextShown && extraScroll > unstickTrigger) {
					shouldUnstick = true;
					$("#statusbar").removeClass("sticky");
					isSticky = false;
				}
			}
		}
	});
});
        </script>
</body>

</html>